#!/usr/bin/env python
# -*- coding: utf-8 -*-

import sys
import hashlib
import time
import random
import timeout_decorator

class Exploit():
    def __init__(self, author, challenge, debug):
        self.challenge = challenge
        self.author = author
        self.debug = debug

    def run(self, target):
        team = target['team']
        host = target['host']
        port = target['port']
        try:
            flag = self.exploit(host, port)
            if self.debug:
                print flag
            return (True, flag)
        except Exception as e:
            if self.debug:
                print repr(e)
            return (False, repr(e))

    @timeout_decorator.timeout(3, use_signals=False)
    def exploit(self, host, port):
        time.sleep(random.choice([1, 4]))
        return "flag{%s}" % hashlib.md5("%s:%d:%s" % (host, port, str(int(time.time()/60/5)))).hexdigest()
        
def main():
    exploit = Exploit("Wang Yihang", "zblog_rce", True)
    target = {
        "team":"PPP",
        "host":"192.168.1.1",
        "port":1337,
    }
    exploit.run(target)

if __name__ == "__main__":
    main()
